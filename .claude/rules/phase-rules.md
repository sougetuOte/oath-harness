# フェーズ別ガードレール

## PLANNING

### 承認ゲート

```
requirements → [承認] → design → [承認] → tasks → [承認] → BUILDING
```

成果物完成時は必ず「承認」を求める。ユーザーが「承認」と言うまで次へ進まない。

### 禁止

- 実装コード生成（.ts, .py, .go 等）
- `src/` への変更
- 設定ファイル変更（package.json, pyproject.toml 等）
- 未承認での次サブフェーズ開始

### 許可

- `docs/specs/`, `docs/adr/`, `docs/tasks/`, `docs/memos/` への出力
- 既存コード読取（仕様策定のため）、Mermaid 図表作成
- `.claude/states/*.json` の更新

---

## BUILDING

### 必須

- 実装前に `docs/specs/` を確認
- TDD サイクル厳守（Red → Green → Refactor）
- コード変更時はドキュメント同期
- 1サイクル完了ごとにユーザーに報告

### 禁止

- 仕様書なし実装
- テストなし実装
- ドキュメント未更新

---

## AUDITING

### 必須

- チェックリストに基づく網羅的確認
- 重要度分類: Critical / Warning / Info
- 3 Agents Model 適用、根拠明示

### コード品質チェック

- [ ] 命名が意図を表現している
- [ ] 単一責任原則を守っている
- [ ] エラーケースが網羅されている

### コード明確性チェック

- [ ] ネストした三項演算子がない
- [ ] 過度に密なワンライナーがない
- [ ] デバッグ・拡張が容易な構造

### ドキュメント・アーキテクチャ

- [ ] 仕様と実装の差異がない
- [ ] ADR 決定事項が反映されている
- [ ] 循環依存がない
- [ ] TODO/FIXME の棚卸し

### 改善提案の禁止事項

- 読みやすさを犠牲にした行数削減
- 有用な抽象化の削除
- 複数の関心事を1関数に統合
- デバッグ困難な「賢い」コード提案
- 主観的な好みに基づく指摘

### レポート形式

```
# 監査レポート
対象: [ファイル/ディレクトリ]
Critical: X件 / Warning: X件 / Info: X件
総合評価: [A/B/C/D]
```

---

## フェーズ警告テンプレート

フェーズルールに反する要求を受けた場合:

```
⚠️ フェーズ警告: 現在は [PHASE] フェーズです。
1. ルールに沿って続行
2. フェーズ切替（/planning, /building, /auditing）
3. 「承知の上で続行」と明示
```
